<%- include('../partials/header', {title: typeof movie !== 'undefined' && movie.title ? 'Edit ' + movie.title : 'Edit Movie'}) %>

<main>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem;">
        <h2 style="margin:0;">Edit Movie</h2>
        <a href="/movies/<%= typeof movie !== 'undefined' && movie._id ? movie._id : '' %>">
            <button class="secondary" style="font-size:0.9rem;padding:0.5rem 1rem;">‚Üê Back to Movie</button>
        </a>
    </div>

    <% if (typeof errors !== 'undefined' && errors && errors.length) { %>
        <div class="errors">
            <ul>
                <% errors.forEach(function(err){ %>
                    <li><%= err %></li>
                <% }) %>
            </ul>
        </div>
    <% } %>

    <% if (typeof movie === 'undefined' || !movie) { %>
        <div style="text-align:center;padding:3rem 2rem;background:#ffffff;border-radius:0.75rem;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1);">
            <p class="muted" style="font-size:1.1rem;">Movie not found.</p>
            <a href="/movies" style="margin-top:1rem;display:inline-block;">
                <button>View All Movies</button>
            </a>
        </div>
    <% } else { %>
        <div class="form-container">
            <form action="/movies/<%= movie._id %>/edit" method="post">
                <div>
                    <label for="title">Title</label>
                    <input type="text" id="title" name="title" required value="<%= movie.title || '' %>" autofocus />
                </div>
                <div>
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="4" required><%= movie.description || '' %></textarea>
                </div>
                <div>
                    <label for="year">Year</label>
                    <input type="number" id="year" name="year" required min="1888" max="<%= new Date().getFullYear() + 1 %>" value="<%= movie.year || '' %>" />
                </div>
                <div>
                    <label for="genres">Genres (comma separated)</label>
                    <input type="text" id="genres" name="genres" placeholder="e.g., Action, Drama, Comedy" value="<%= movie.genres && movie.genres.length > 0 ? movie.genres.join(', ') : '' %>" required />
                </div>

                <div style="display:flex;gap:0.75rem;flex-wrap:wrap;">
                    <button type="submit">Save Changes</button>
                    <a href="/movies/<%= movie._id %>">
                        <button type="button" class="secondary">Cancel</button>
                    </a>
                </div>
            </form>
        </div>
    <% } %>
</main>

<%- include('../partials/footer') %>
